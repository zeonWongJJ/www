webpackJsonp([7],{KvW5:function(t,e,o){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var a=o("fZjL"),l=o.n(a),n={render:function(){var t=this.$createElement,e=this._self._c||t;return e("section",[e("Tree",{ref:"tree",attrs:{data:this.authList,"show-checkbox":""}})],1)},staticRenderFns:[]};var r=o("VU/8")({name:"AuthTreeCheckBox",computed:{roleId:function(){return this.$store.state.auth.roleId||0}},data:function(){return{authList:[]}},watch:{roleId:function(t,e){var o=this;t&&this.$http("auth.role.assigned-"+t).then(function(t){o.authList=t.data})}}},n,!1,function(t){o("jpAR")},"data-v-acd27176",null).exports,i=o("GXH0"),s=o.n(i),d=(o("DmJO"),{name:"authIndex",components:{Treeselect:s.a,AuthTreeCheckBox:r},mounted:function(){this.getRoleData()},data:function(){return{ruleForm:{id:0,parent_id:0,role_name:"",role_info:"",role_status:!0},loading:!1,modalTitle:"新增角色",showModal:!1,showCheckBoxModal:!1,roleData:[],columns:[{label:"角色名称",prop:"label"},{label:"操作",type:"template",template:"_action",width:300}],buttonProps:{size:"small"}}},methods:{getRoleData:function(){var t=this;this.$http("auth.role.list",{"data-set":"tree",field:"role_name as label"}).then(function(e){t.roleData=e.data,t.checkRoleHasTopper()})},ok:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;delete this.ruleForm.id,e?this.$http("auth.role.add",this.ruleForm).then(function(){t.getRoleData()}):this.$http("auth.role.update-"+e,this.ruleForm).then(function(){t.getRoleData()})},checkRoleHasTopper:function(){"==最顶级角色=="!==this.roleData[0].label&&this.roleData.unshift({id:0,label:"==最顶级角色==",parent_id:0})},updateRow:function(t){var e=this;t&&(this.loading=!0,this.modalTitle="修改角色",this.checkRoleHasTopper(),this.$http("auth.role.get-"+t).then(function(t){t.data&&(t.data.role_status="1"===t.data.role_status),l()(e.ruleForm).forEach(function(o){e.ruleForm[o]=t.data[o]||""}),e.loading=!1,e.showModal=!0})),this.loading=!1},addSon:function(t){var e=this;this.loading=!0,this.modalTitle="添加下级角色",this.checkRoleHasTopper(),l()(this.ruleForm).forEach(function(o){e.ruleForm[o]="parent_id"===o?parseInt(t):""}),this.loading=!1,this.showModal=!0},handleRemoveRole:function(t){var e=this;t&&(this.loading=!0,this.$http("auth.role.delete-"+t).then(function(){e.getRoleData(),e.loading=!1}).catch(function(t){e.loading=!1,t.forEach(function(t){e.$Message.warning(t)})}))},handleAllowRule:function(t){if(arguments.length>1&&void 0!==arguments[1]&&arguments[1]){var e=[];this.$refs.authTreeCheckBox.$refs.tree.getCheckedAndIndeterminateNodes().forEach(function(t){e.push(parseInt(t.id))}),this.$http("auth.role.assign-"+t,{assign_ids:e}).then(function(t){})}else this.$store.commit("SET_ROLE_ID",0),this.$store.commit("SET_ROLE_ID",t),this.showCheckBoxModal=!0}}}),c={render:function(){var t=this,e=t.$createElement,o=t._self._c||e;return o("div",[o("Card",{attrs:{title:"角色列表"}},[o("Button",{staticStyle:{"margin-bottom":"10px"},attrs:{size:"small",type:"primary",icon:"md-add"},on:{click:function(e){t.showModal=!0,t.modalTitle="添加角色"}}},[t._v("添加角色")]),t._v(" "),o("zk-table",{ref:"table",attrs:{id:"roleTreeTable","sum-text":"sum","index-text":"#","selection-type":!1,data:t.roleData,columns:t.columns,stripe:!0,border:!0,"tree-type":!0,"is-fold":!0,"expand-type":!1},scopedSlots:t._u([{key:"_action",fn:function(e){return[e.row.id?o("Button",{attrs:{disabled:t.loading,size:"small",type:"default"},nativeOn:{click:function(o){t.updateRow(e.row.id)}}},[t._v("修改信息")]):t._e(),t._v(" "),e.row.id?o("Button",{attrs:{disabled:t.loading,size:"small",type:"default"},nativeOn:{click:function(o){t.handleAllowRule(e.row.id)}}},[t._v("权限分配")]):t._e(),t._v(" "),e.row.id?o("Button",{attrs:{disabled:t.loading,size:"small",type:"success"},nativeOn:{click:function(o){t.addSon(e.row.id||0)}}},[t._v("添加下级")]):t._e(),t._v(" "),e.row.id?o("Button",{attrs:{disabled:t.loading,size:"small",type:"warning"},nativeOn:{click:function(o){t.handleRemoveRole(e.row.id||0)}}},[t._v("删除")]):t._e()]}}])})],1),t._v(" "),o("Modal",{attrs:{"mask-closable":!1,title:t.modalTitle},on:{"on-ok":t.ok},model:{value:t.showModal,callback:function(e){t.showModal=e},expression:"showModal"}},[o("Form",{ref:"formInline",attrs:{model:t.ruleForm,"label-width":80}},[o("FormItem",{attrs:{prop:"role_name",label:"所属上级"}},[o("treeselect",{ref:"roleSelect",staticStyle:{width:"300px"},attrs:{value:t.ruleForm.parent_id||t.roleData[0].id,searchable:!1,multiple:!1,options:t.roleData,placeholder:"点击选择上级角色",noChildrenText:"该角色暂无下级"}})],1),t._v(" "),o("FormItem",{attrs:{prop:"role_name",label:"角色名称"}},[o("Input",{attrs:{type:"text",placeholder:"角色名称"},model:{value:t.ruleForm.role_name,callback:function(e){t.$set(t.ruleForm,"role_name",e)},expression:"ruleForm.role_name"}})],1),t._v(" "),o("FormItem",{attrs:{prop:"role_name",label:"角色描述"}},[o("Input",{attrs:{type:"textarea",autosize:{minRows:2,maxRows:5},placeholder:"角色描述"},model:{value:t.ruleForm.role_info,callback:function(e){t.$set(t.ruleForm,"role_info",e)},expression:"ruleForm.role_info"}})],1),t._v(" "),o("FormItem",{attrs:{label:"角色组状态"}},[o("i-switch",{attrs:{size:"large"},model:{value:t.ruleForm.role_status,callback:function(e){t.$set(t.ruleForm,"role_status",e)},expression:"ruleForm.role_status"}},[o("span",{attrs:{slot:"open"},slot:"open"},[t._v("开启")]),t._v(" "),o("span",{attrs:{slot:"close"},slot:"close"},[t._v("关闭")])])],1)],1)],1),t._v(" "),o("Modal",{staticStyle:{height:"800px"},attrs:{title:"分配权限"},on:{"on-ok":function(e){t.handleAllowRule(t.$store.state.auth.roleId,!0)}},model:{value:t.showCheckBoxModal,callback:function(e){t.showCheckBoxModal=e},expression:"showCheckBoxModal"}},[o("auth-tree-check-box",{ref:"authTreeCheckBox"})],1)],1)},staticRenderFns:[]};var u=o("VU/8")(d,c,!1,function(t){o("tV5A")},"data-v-6c0093c6",null);e.default=u.exports},jpAR:function(t,e){},tV5A:function(t,e){}});
//# sourceMappingURL=7.775505576def67481f3a.js.map