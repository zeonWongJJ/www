webpackJsonp([6],{Ip2E:function(e,l){},aVcx:function(e,l,t){"use strict";Object.defineProperty(l,"__esModule",{value:!0});var r=t("fZjL"),o=t.n(r),a=t("GXH0"),n=t.n(a),u=(t("DmJO"),[{label:"菜单名称",prop:"label",width:200},{label:"接口路由",type:"template",template:"rule_api",width:160}]),s=u.concat([{label:"鉴权等级",prop:"rule_level"},{label:"是否开启",type:"template",template:"rule_enable"},{label:"排序",prop:"rule_sort"},{label:"操作",type:"template",template:"_action",width:180}]),i={name:"RuleTable",components:{Treeselect:n.a},props:{isOwnPage:{type:Boolean,default:function(){return!1}}},watch:{showModal:function(e){e?this.ruleData.unshift({label:"==作为最上级==",id:0,parent_id:0}):"==作为最上级=="===this.ruleData[0].label&&this.ruleData.shift()}},mounted:function(){this.getRuleTree()},data:function(){return{ruleCustom:{rule_name:[{required:!0,message:"规则名称不能空",trigger:"blur"}],rule_controller:[{required:!0,message:"规则所属控制器不能空",trigger:"blur"}],rule_action:[{required:!0,message:"规则所属方法不能空",trigger:"blur"}]},ruleForm:{rule_name:"",rule_controller:"",rule_action:"",rule_router_param:"",rule_enable:!0,parent_id:0,rule_level:1,is_menu:!0,rule_sort:50},showModal:!1,modalTitle:"添加权限节点",ruleData:[],columns:u,ownPageColumns:s,props:{showRowHover:!0,isFold:!this.isOwnPage,expandType:!1}}},methods:{getRuleTree:function(){var e=this;this.$http("auth.rule.list",{"data-set":"tree",field:"rule_name as label, rule_level, rule_enable, rule_sort, rule_controller, rule_action, rule_router_param"}).then(function(l){e.ruleData=l.data})},handleAddSon:function(e){this.ruleForm.parent_id=parseInt(e),this.showModal=!0,this.modalTitle="添加子级"},handlePostRule:function(){var e=this,l=void 0;l=this.ruleForm.id?"auth.rule.update-"+this.ruleForm.id:"auth.rule.add",this.ruleForm.parent_id=this.$refs.ruleSelect.getValue(),this.$http(l,this.ruleForm).then(function(){e.getRuleTree(),e.$refs.form.resetFields()})},handleUpdate:function(e){var l=this;e&&this.$http("auth.rule.get-"+e).then(function(t){t.data.rule_level=parseInt(t.data.rule_level),t.data.rule_enable=1==t.data.rule_enable,o()(l.ruleForm).forEach(function(e){l.ruleForm[e]=t.data[e]||""}),l.ruleForm.id=e,l.showModal=!0,l.modalTitle="修改规则"})},handleRemoveRule:function(e){var l=this;e&&this.$Modal.confirm({title:"确认删除？",content:"<p>此操作不可逆，确定要删除吗？</p>",onOk:function(){l.$http("auth.rule.delete-"+e).then(function(){l.getRuleTree()})}})},handleChangeEnable:function(e){var l=this;this.$http("auth.rule.enable-"+e).then(function(){}).catch(function(e){l.$Message.info("操作失败"),l.getRuleTree()})}}},c={render:function(){var e=this,l=e.$createElement,t=e._self._c||l;return t("div",{staticStyle:{"margin-bottom":"10px"}},[t("Row",{staticStyle:{"margin-bottom":"10px"}},[t("Button",{attrs:{size:"small",type:"success",icon:"md-add"},on:{click:function(l){e.showModal=!0,e.modalTitle="添加权限节点",e.ruleForm.parent_id=0,delete e.ruleForm.id}}},[e._v("添加权限节点")]),e._v(" "),e.isOwnPage?t("Button",{attrs:{size:"small",type:"primary"},on:{click:function(l){e.props.isFold=!e.props.isFold}}},[e._v(e._s(e.props.isFold?"展开":"收起"))]):e._e()],1),e._v(" "),t("zk-table",{ref:"table",attrs:{id:"ruleTreeTable","sum-text":"sum","index-text":"#","selection-type":!e.isOwnPage,data:e.ruleData,columns:e.isOwnPage?e.ownPageColumns:e.columns,stripe:!0,border:!0,"tree-type":!0,"is-fold":e.props.isFold,"expand-type":!1},scopedSlots:e._u([{key:"rule_enable",fn:function(l){return[t("i-switch",{on:{"on-change":function(t){e.handleChangeEnable(l.row.id)}},model:{value:1==l.row.rule_enable,callback:function(t){e.$set(l.row,"rule_enable == 1",t)},expression:"scope.row.rule_enable == 1"}},[t("Icon",{attrs:{slot:"open",type:"md-checkmark"},slot:"open"}),e._v(" "),t("Icon",{attrs:{slot:"close",type:"md-close"},slot:"close"})],1)]}},{key:"rule_api",fn:function(l){return[t("span",[e._v(e._s(l.row.rule_controller+"/"+l.row.rule_action+"/"+l.row.rule_router_param))])]}},{key:"_action",fn:function(l){return[t("Button",{attrs:{size:"small",type:"default"},on:{click:function(t){e.handleUpdate(l.row.id||0)}}},[e._v("修改")]),e._v(" "),t("Button",{attrs:{size:"small",type:"success"},on:{click:function(t){e.handleAddSon(l.row.id||0)}}},[e._v("添加下级")]),e._v(" "),t("Button",{attrs:{size:"small",type:"warning"},on:{click:function(t){e.handleRemoveRule(l.row.id||0)}}},[e._v("删除")])]}}])}),e._v(" "),t("Modal",{attrs:{title:e.modalTitle},on:{"on-ok":e.handlePostRule},model:{value:e.showModal,callback:function(l){e.showModal=l},expression:"showModal"}},[t("Form",{ref:"form",attrs:{"label-width":100},model:{value:e.ruleForm,callback:function(l){e.ruleForm=l},expression:"ruleForm"}},[t("FormItem",{attrs:{prop:"parent_id",label:"规则所属上级id"}},[t("treeselect",{ref:"ruleSelect",staticStyle:{width:"300px"},attrs:{value:e.ruleForm.parent_id||e.ruleData[0].id,searchable:!1,multiple:!1,options:e.ruleData,placeholder:"点击选择上级角色",noChildrenText:"该角色暂无下级"}})],1),e._v(" "),t("FormItem",{attrs:{prop:"rule_name",label:"规则名称"}},[t("Input",{model:{value:e.ruleForm.rule_name,callback:function(l){e.$set(e.ruleForm,"rule_name",l)},expression:"ruleForm.rule_name"}})],1),e._v(" "),t("FormItem",{attrs:{prop:"rule_controller",label:"规则所属控制器"}},[t("Input",{model:{value:e.ruleForm.rule_controller,callback:function(l){e.$set(e.ruleForm,"rule_controller",l)},expression:"ruleForm.rule_controller"}})],1),e._v(" "),t("FormItem",{attrs:{prop:"rule_action",label:"规则所属方法"}},[t("Input",{model:{value:e.ruleForm.rule_action,callback:function(l){e.$set(e.ruleForm,"rule_action",l)},expression:"ruleForm.rule_action"}})],1),e._v(" "),t("FormItem",{attrs:{prop:"rule_router_param",label:"规则路由参数"}},[t("Input",{model:{value:e.ruleForm.rule_router_param,callback:function(l){e.$set(e.ruleForm,"rule_router_param",l)},expression:"ruleForm.rule_router_param"}})],1),e._v(" "),t("FormItem",{attrs:{prop:"rule_enable",label:"规则是否开启"}},[t("i-switch",{attrs:{size:"large"},model:{value:e.ruleForm.rule_enable,callback:function(l){e.$set(e.ruleForm,"rule_enable",l)},expression:"ruleForm.rule_enable"}},[t("span",{attrs:{slot:"open"},slot:"open"},[e._v("开启")]),e._v(" "),t("span",{attrs:{slot:"close"},slot:"close"},[e._v("关闭")])])],1),e._v(" "),t("FormItem",{attrs:{prop:"rule_level",label:"规则认证等级"}},[t("Select",{model:{value:e.ruleForm.rule_level,callback:function(l){e.$set(e.ruleForm,"rule_level",l)},expression:"ruleForm.rule_level"}},[t("Option",{attrs:{value:1}},[e._v("只判断是否登录")]),e._v(" "),t("Option",{attrs:{value:2}},[e._v("判断登录+权限")])],1)],1),e._v(" "),t("FormItem",{attrs:{prop:"rule_sort",label:"菜单排序"}},[t("Input",{model:{value:e.ruleForm.rule_sort,callback:function(l){e.$set(e.ruleForm,"rule_sort",l)},expression:"ruleForm.rule_sort"}}),e._v(" "),t("span",[e._v("数字越大排序越靠前")])],1)],1)],1)],1)},staticRenderFns:[]};var m={name:"ruleIndex",components:{RuleTable:t("VU/8")(i,c,!1,function(e){t("i7UE")},"data-v-caae7586",null).exports}},p={render:function(){var e=this.$createElement,l=this._self._c||e;return l("Card",{attrs:{title:"权限管理"}},[l("rule-table",{attrs:{isOwnPage:!0}})],1)},staticRenderFns:[]};var d=t("VU/8")(m,p,!1,function(e){t("Ip2E")},"data-v-74104286",null);l.default=d.exports},i7UE:function(e,l){}});
//# sourceMappingURL=6.54a15c20a1a31b0f32b4.js.map